# Week2: Content-based recommendation

## 專案目的

透過Amazon購物網站的美妝消費資料，萃取`客戶購買之商品`、`評論歷史資訊`等影響推薦成效之欄位，建置協同過濾(Collaborative filtering)的方式，替指定消費者，以推薦使用者所在的群組中熱門的項目(User-based)或推薦被同一群使用者共同喜歡的商品(Item-based)，推薦k個商品，並使用`是否實際購買推薦商品`作為評估recall score成效指標

## 使用工具
   * Python: gzip, json, time, pandas, surprise, collecitons, itertools, matplotlib, seaborn
   * Google Colab

## 使用資料
   1. 資料來源： 
       * `All_beauty.csv`： [連結](http://deepyeti.ucsd.edu/jianmo/amazon/categoryFilesSmall/All_Beauty.csv)
       * `meta_All_Beauty.json.gz`：[連結](http://deepyeti.ucsd.edu/jianmo/amazon/metaFiles2/meta_All_Beauty.json.gz)
   2. 資料描述：
       * `All_beauty.csv`：提供客戶商品申購、評論歷史資訊
          * 時間區間：2000-01-10 ~ 2018-10-02
          * 資料筆數：371,345
          * 訓練資料：2000-01-10 ~ 2018-09-01 （僅surprise因RAM不足，使用2017-09-01 ~ 2018-09-01）
          * 測試資料：2018-09-01 ~ 2018-09-30 

## 資料清洗
   * 調整rantings中`unixReviewTime`成日期格式
   * 發現rating有客戶於同一天購買相同商品、評價分數相同（共9,070筆），因影響資料準確性排除
   * 發現rating有603位客戶於不同天購買相同商品、評價分數不同（共670筆），因會影響user_to_items與item_to_users計算，因此採用最新一筆的評價，其餘排除，最終rating資料筆數從371,345變為361,605

## EDA
   * 整體客戶之評分分佈：rating >= 4的佔比為75.8% ，用戶給予的商品評分都蠻高的
   * 客戶評分分布 vs 時間：綜觀時間維度，其分佈與整體差異不大，主要分布於4分以上(佔比70~80%)
   * 每個客戶之購買次數分佈: 客戶主要購買次數為1次（佔比90.9%)
   * 每位客戶購買次數分佈 vs 時間 : 從2008年後開始明顯有客戶購買3次以上，但2016年開始客戶購買之次數開始有走下坡趨勢
   * 整體商品之購買次數分佈：每個商品總購買次數區間主要落在1～1000之間，購買次數1~5主要佔76%
   * 商品的購買次數分佈 vs 時間 ：近兩年每月各商品購買次數分佈主要1~5次（佔比達近90%)
   * 評價與銷量關係：商品平均評價越高，不一定與商品銷量有正向或負向關係，因此決定評價不納入相似度篩選條件

## 推薦規則

### User-based：
  1. 篩選評分筆數大於等於3的用戶後，用戶由323,489人變成4,793人
  2. 測試資料584名用戶中，只有38名曾經於訓練集資料出現，但38位用戶中有92.1%的人評分筆數少於3次，導致篩選過後僅有3名用戶進行推薦，推薦準度為0%
  3. 從EDA發現過去多數用戶購買1~2個商品，容易導致推薦數難達到10個商品，可從有被推薦的3名用戶觀察到此現象
  4. 曾嘗試不設定篩選評分筆數，然記憶體不足以運算，故不調整此參數，維持篩選大於3的用戶


### Item-based：
  1. 測試資料584名用戶中，只有38名曾經於訓練集資料出現，32位用戶有被推薦，僅1位用戶有被成功推薦，推薦準度為0.169%
  2. 未被推薦的6位用戶，主因為他們購買的商品僅被購買一次，且並未被其他user同時購買其他產品，因此在計算相似度時被排除

### Surprise：
   1. 使用cosine similarity計算相似度矩陣
   2. 使用colab有將資料區間篩選為近一年，避免記憶體資料不足去運算
   3. 推薦準度為0.169%
   
## 結論
* 測試資料584名用戶中，只有38名曾經於訓練集資料出現，此外用戶購買不同商品數多寡或是否不同商品有被其他用戶購買數，皆影響最終推薦商品的數量
* 38位用戶中，6個用戶所購買產品主要為近一個月Top20，顯示此客戶消費特性使用rule-based有較佳推薦準度


